include ../../common/make.config

# ========================================================================================================================================================================================================200
#	EXECUTABLES (LINK OBJECTS TOGETHER INTO BINARY)
# ========================================================================================================================================================================================================200

EXE = main

$(EXE): ./main.o \
			./kernel/kernel_gpu_opencl_wrapper.o \
			./util/file/file.o \
			./util/num/num.o \
			./util/timer/timer.o \
			./util/opencl/opencl.o
	$(CC)	./main.o \
			./kernel/kernel_gpu_opencl_wrapper.o \
			./util/file/file.o \
			./util/num/num.o \
			./util/timer/timer.o \
			./util/opencl/opencl.o \
			-lm $(OCL_LDFLAGS) \
                        -o $(EXE)
# ========================================================================================================================================================================================================200
#	OBJECTS (COMPILE SOURCE FILES INTO OBJECTS)
# ========================================================================================================================================================================================================200

# ======================================================================================================================================================150
#	MAIN FUNCTION
# ======================================================================================================================================================150

./main.o:	./common.h \
			./main.h \
			./main.c
	$(CC) $(CC_FLAGS) ./main.c \
			-c \
			-o ./main.o

# ======================================================================================================================================================150
#	KERNELS
# ======================================================================================================================================================150

./kernel/kernel_gpu_opencl_wrapper.o:	./common.h \
										./kernel/kernel_gpu_opencl_wrapper.h \
										./kernel/kernel_gpu_opencl_wrapper.c \
										./kernel/solver.c \
										./kernel/embedded_fehlberg_7_8.c \
										./kernel/master.c \
										./kernel/kernel_gpu_opencl.cl
	$(CC) $(CC_FLAGS) $(OCL_CPPFLAGS) -c ./kernel/kernel_gpu_opencl_wrapper.c \
			-o ./kernel/kernel_gpu_opencl_wrapper.o

# ======================================================================================================================================================150
#	UTILITIES
# ======================================================================================================================================================150

./util/file/file.o:	./common.h \
					./util/file/file.h \
					./util/file/file.c
	$(CC) $(CC_FLAGS) ./util/file/file.c \
			-c \
			-o ./util/file/file.o

./util/num/num.o:	./common.h \
					./util/num/num.h \
					./util/num/num.c
	$(CC) $(CC_FLAGS) ./util/num/num.c \
			-c \
			-o ./util/num/num.o

./util/timer/timer.o:	./common.h \
						./util/timer/timer.h \
						./util/timer/timer.c
	$(CC)  $(CC_FLAGS) ./util/timer/timer.c \
			-c \
			-o ./util/timer/timer.o

./util/opencl/opencl.o:	./common.h \
						./util/opencl/opencl.h \
						./util/opencl/opencl.c
	$(CC) $(CC_FLAGS) $(OCL_CPPFLAGS)  \
		./util/opencl/opencl.c \
			-c \
			-o ./util/opencl/opencl.o

# ======================================================================================================================================================150
#	END
# ======================================================================================================================================================150

# ========================================================================================================================================================================================================200
#	DELETE
# ========================================================================================================================================================================================================200

clean:
	rm  -f  *.o $(EXE) \
		./kernel/*.o \
		./util/file/*.o \
		./util/timer/*.o \
		./util/opencl/*.o \
                ./util/num/*.o \
                ./output.txt
# ========================================================================================================================================================================================================200
#	END
# ========================================================================================================================================================================================================200
